import Tag_Utils
import Featurizers
from CRF_Tagger import CRF_Tagger

training_data_path = 'ud-treebanks-v2.13/UD_English-EWT/en_ewt-ud-train.conllu'
dev_data_path = 'ud-treebanks-v2.13/UD_English-EWT/en_ewt-ud-dev.conllu'

train_tokens_by_sent, train_tags_by_sent = Tag_Utils.load_data(training_data_path)
dev_tokens_by_sent, dev_tags_by_sent = Tag_Utils.load_data(dev_data_path)

search_space = {'c1': [10.0, 1.0, 1e-1, 1e-2, 1e-3, 0.0], 'c2': [1.0, 1e-1, 1e-2, 1e-3, 1e-4, 1e-5, 0.0]}
accuracy_matrix = {val1 : {val2 : -1 for val2 in search_space['c2']} for val1 in search_space['c1']}

for val1 in search_space['c1']:
    for val2 in search_space['c2']:
        hyperparameters = {'c1' : val1, 'c2': val2, 'max_iterations':100}
        tagger = CRF_Tagger(Featurizers.combo_featurize_auto)
        tagger.train(train_tokens_by_sent, train_tags_by_sent, algorithm='lbfgs', hyperparameters=hyperparameters)
        predictions = Tag_Utils.predict(tagger, dev_tokens_by_sent)
        accuracy_matrix[val1][val2] = Tag_Utils.accuracy(dev_tags_by_sent, predictions)

print(accuracy_matrix)

# {10.0: {1.0: 0.8755914277762316, 0.1: 0.8781360582084211, 0.01: 0.8780962983579181, 0.001: 0.8781758180589241, 0.0001: 0.8779372589559064, 1e-05: 0.878295097610433, 0.0: 0.8780962983579181}, 1.0: {1.0: 0.9130452069500219, 0.1: 0.9165440737942825, 0.01: 0.9162259949902588, 0.001: 0.9175778299073596, 0.0001: 0.9162657548407618, 1e-05: 0.9166235934952884, 0.0: 0.9161862351397558}, 0.1: {1.0: 0.922388771818218, 0.1: 0.9238996461373306, 0.01: 0.9225478112202298, 0.001: 0.9231442089777743, 0.0001: 0.9226273309212357, 1e-05: 0.921275496004135, 0.0: 0.9227863703232476}, 0.01: {1.0: 0.9237008468848157, 0.1: 0.9222297324162061, 0.01: 0.9209176573496084, 0.001: 0.9196055822830106, 0.0001: 0.9197248618345195, 1e-05: 0.9184923064689277, 0.0: 0.9188501451234543}, 0.001: {1.0: 0.9235020476323009, 0.1: 0.9225478112202298, 0.01: 0.9197646216850225, 0.001: 0.9176175897578626, 0.0001: 0.9172995109538388, 1e-05: 0.91718023140233, 0.0: 0.9170211920003181}, 0.0: {1.0: 0.9239394059878335, 0.1: 0.9238201264363246, 0.01: 0.9222297324162061, 0.001: 0.9228658900242535, 0.0001: 0.9225478112202298, 1e-05: 0.9222694922667091, 0.0: 0.9225080513697268}}
# {10.0: {1.0: 0.8755914277762316, 0.1: 0.8781360582084211, 0.01: 0.8780962983579181, 0.001: 0.8781758180589241, 0.0001: 0.8779372589559064, 1e-05: 0.878295097610433, 0.0: 0.8780962983579181}, 1.0: {1.0: 0.9130452069500219, 0.1: 0.9165440737942825, 0.01: 0.9162259949902588, 0.001: 0.9175778299073596, 0.0001: 0.9162657548407618, 1e-05: 0.9166235934952884, 0.0: 0.9161862351397558}, 0.1: {1.0: 0.922388771818218, 0.1: 0.9238996461373306, 0.01: 0.9225478112202298, 0.001: 0.9231442089777743, 0.0001: 0.9226273309212357, 1e-05: 0.921275496004135, 0.0: 0.9227863703232476}, 0.01: {1.0: 0.9237008468848157, 0.1: 0.9222297324162061, 0.01: 0.9209176573496084, 0.001: 0.9196055822830106, 0.0001: 0.9197248618345195, 1e-05: 0.9184923064689277, 0.0: 0.9188501451234543}, 0.001: {1.0: 0.9235020476323009, 0.1: 0.9225478112202298, 0.01: 0.9197646216850225, 0.001: 0.9176175897578626, 0.0001: 0.9172995109538388, 1e-05: 0.91718023140233, 0.0: 0.9170211920003181}, 0.0: {1.0: 0.9239394059878335, 0.1: 0.9238201264363246, 0.01: 0.9222297324162061, 0.001: 0.9228658900242535, 0.0001: 0.9225478112202298, 1e-05: 0.9222694922667091, 0.0: 0.9225080513697268}}
# {10.0: {1.0: 0.8895868951532743, 0.1: 0.8943183173631267, 0.01: 0.8943580772136297, 0.001: 0.8949942348216771, 0.0001: 0.8945171166156415, 1e-05: 0.8942387976621208, 0.0: 0.8943580772136297}, 1.0: {1.0: 0.9207586179475965, 0.1: 0.9268418750745497, 0.01: 0.9277961114866208, 0.001: 0.9283527493936623, 0.0001: 0.9283527493936623, 1e-05: 0.9281937099916504, 0.0: 0.9277165917856149}, 0.1: {1.0: 0.9235020476323009, 0.1: 0.9287901077491949, 0.01: 0.9310961790783666, 0.001: 0.9330444117530118, 0.0001: 0.9320106556399348, 1e-05: 0.932885372351, 0.0: 0.9326468132479822}, 0.01: {1.0: 0.9237406067353187, 0.1: 0.9266828356725378, 0.01: 0.9285515486461771, 0.001: 0.9314937775833962, 0.0001: 0.9320106556399348, 1e-05: 0.9311756987793726, 0.0: 0.9317323366864141}, 0.001: {1.0: 0.923422527931295, 0.1: 0.9265237962705261, 0.01: 0.9278358713371238, 0.001: 0.929744344161266, 0.0001: 0.9300624229652896, 1e-05: 0.9308973798258519, 0.0: 0.9308178601248459}, 0.0: {1.0: 0.9231044491272713, 0.1: 0.9271997137290764, 0.01: 0.9230646892767683, 0.001: 0.9233032483797861, 0.0001: 0.9221104528646973, 1e-05: 0.9222694922667091, 0.0: 0.9225875710707327}}
# {10.0: {1.0: 0.8870422647210846, 0.1: 0.8934436006520615, 0.01: 0.8936026400540734, 0.001: 0.894039998409606, 0.0001: 0.8936821597550794, 1e-05: 0.8937219196055823, 0.0: 0.8936026400540734}, 1.0: {1.0: 0.9188103852729513, 0.1: 0.9261261977654964, 0.01: 0.9274780326825971, 0.001: 0.9272394735795794, 0.0001: 0.9266033159715319, 1e-05: 0.9279949107391356, 0.0: 0.9270804341775675}, 0.1: {1.0: 0.9178163890103773, 0.1: 0.9257285992604668, 0.01: 0.9293467456562363, 0.001: 0.9304202616198163, 0.0001: 0.9303805017693133, 1e-05: 0.9297841040117689, 0.0: 0.9308576199753489}, 0.01: {1.0: 0.918054948113395, 0.1: 0.9244960438948749, 0.01: 0.9261261977654964, 0.001: 0.928670828197686, 0.0001: 0.9295853047592542, 1e-05: 0.929744344161266, 0.0: 0.9298636237127749}, 0.001: {1.0: 0.9176971094588684, 0.1: 0.9240189256888394, 0.01: 0.9246153234463839, 0.001: 0.9263647568685142, 0.0001: 0.9270804341775675, 1e-05: 0.9295853047592542, 0.0: 0.9277165917856149}, 0.0: {1.0: 0.9178959087113833, 0.1: 0.9254502803069461, 0.01: 0.9228261301737506, 0.001: 0.9218718937616794, 0.0001: 0.9211562164526261, 1e-05: 0.9194067830304958, 0.0: 0.9190091845254662}}